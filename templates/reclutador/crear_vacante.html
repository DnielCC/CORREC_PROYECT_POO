{% extends "reclutador/base.html" %}

{% block title %}Crear Vacante - Reclutador{% endblock %}

{% block page_title %}Publicar Vacante{% endblock %}

{% block content %}
<!-- Header -->
<div style="margin-bottom: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h2 style="font-size: 1.5rem; font-weight: 600; color: #1F2937; margin-bottom: 0.5rem;">Crear Nueva Vacante</h2>
            <p style="color: #6B7280; margin: 0;">Completa todos los campos para publicar una nueva vacante</p>
        </div>
        <a href="{{ url_for('reclutador_vacantes') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i>
            Volver a Vacantes
        </a>
    </div>
</div>

<!-- Form -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Información de la Vacante</h3>
    </div>
    
    <form class="card-body" method="POST" action="{{ url_for('reclutador_crear_vacante') }}">
        <div class="grid grid-cols-2">
            <!-- Basic Information -->
            <div>
                <h4 style="font-size: 1.125rem; font-weight: 600; color: #1F2937; margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #E5E7EB;">
                    <i class="fas fa-info-circle" style="color: #3B82F6; margin-right: 0.5rem;"></i>
                    Información Básica
                </h4>
                
                <div class="form-group">
                    <label class="form-label" for="job_title">Título del Puesto *</label>
                    <input type="text" id="job_title" name="job_title" class="form-input" placeholder="Ej: Desarrollador Frontend Senior" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="company">Empresa *</label>
                    <input type="text" id="company" name="company" class="form-input" placeholder="Nombre de la empresa" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="location">Ubicación *</label>
                    <input type="text" id="location" name="location" class="form-input" placeholder="Ciudad, Estado, País" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="job_type">Tipo de Trabajo *</label>
                    <select id="job_type" name="job_type" class="form-select" required>
                        <option value="">Selecciona el tipo de trabajo</option>
                        <option value="full-time">Tiempo Completo</option>
                        <option value="part-time">Medio Tiempo</option>
                        <option value="contract">Por Contrato</option>
                        <option value="internship">Prácticas</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="work_mode">Modalidad de Trabajo *</label>
                    <select id="work_mode" name="work_mode" class="form-select" required>
                        <option value="">Selecciona la modalidad</option>
                        <option value="presencial">Presencial</option>
                        <option value="remote">Remoto</option>
                        <option value="hybrid">Híbrido</option>
                    </select>
                </div>
            </div>
            
            <!-- Additional Information -->
            <div>
                <h4 style="font-size: 1.125rem; font-weight: 600; color: #1F2937; margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #E5E7EB;">
                    <i class="fas fa-dollar-sign" style="color: #10B981; margin-right: 0.5rem;"></i>
                    Detalles Adicionales
                </h4>
                
                <div class="form-group">
                    <label class="form-label" for="salary_min">Salario Mínimo (MXN)</label>
                    <input type="number" id="salary_min" name="salary_min" class="form-input" placeholder="25000">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="salary_max">Salario Máximo (MXN)</label>
                    <input type="number" id="salary_max" name="salary_max" class="form-input" placeholder="45000">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="experience_level">Nivel de Experiencia *</label>
                    <select id="experience_level" name="experience_level" class="form-select" required>
                        <option value="">Selecciona el nivel</option>
                        <option value="entry">Sin experiencia</option>
                        <option value="junior">Junior (1-3 años)</option>
                        <option value="mid">Mid-level (3-5 años)</option>
                        <option value="senior">Senior (5+ años)</option>
                        <option value="lead">Lead/Manager</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="deadline">Fecha Límite de Postulación</label>
                    <input type="date" id="deadline" name="deadline" class="form-input">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="vacancies_count">Número de Vacantes</label>
                    <input type="number" id="vacancies_count" name="vacancies_count" class="form-input" placeholder="1" value="1" min="1">
                </div>
            </div>
        </div>
        
        <!-- Description Section -->
        <div style="margin-top: 2rem;">
            <h4 style="font-size: 1.125rem; font-weight: 600; color: #1F2937; margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #E5E7EB;">
                <i class="fas fa-file-alt" style="color: #8B5CF6; margin-right: 0.5rem;"></i>
                Descripción y Requisitos
            </h4>
            
            <div class="form-group">
                <label class="form-label" for="job_description">Descripción del Puesto *</label>
                <textarea id="job_description" name="job_description" class="form-textarea" placeholder="Describe las responsabilidades principales del puesto..." required></textarea>
            </div>
            
            <div class="grid grid-cols-2">
                <div class="form-group">
                    <label class="form-label" for="requirements">Requisitos *</label>
                    <textarea id="requirements" name="requirements" class="form-textarea" placeholder="Lista los requisitos mínimos para el puesto..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="benefits">Beneficios</label>
                    <textarea id="benefits" name="benefits" class="form-textarea" placeholder="Describe los beneficios que ofrece la empresa..."></textarea>
                </div>
            </div>
        </div>
        
        <!-- Skills Section -->
        <div style="margin-top: 2rem;">
            <h4 style="font-size: 1.125rem; font-weight: 600; color: #1F2937; margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #E5E7EB;">
                <i class="fas fa-tags" style="color: #F59E0B; margin-right: 0.5rem;"></i>
                Habilidades y Tecnologías
            </h4>
            
            <div class="form-group">
                <label class="form-label" for="skills">Habilidades Requeridas</label>
                <input type="text" id="skills" name="skills" class="form-input" placeholder="Ej: JavaScript, React, Node.js, Git">
                <small style="color: #6B7280; font-size: 0.75rem;">Separa las habilidades con comas</small>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="nice_to_have">Habilidades Deseadas (Opcional)</label>
                <input type="text" id="nice_to_have" name="nice_to_have" class="form-input" placeholder="Ej: TypeScript, AWS, Docker">
                <small style="color: #6B7280; font-size: 0.75rem;">Habilidades que serían un plus</small>
            </div>
        </div>
        
        <!-- Contact Information -->
        <div style="margin-top: 2rem;">
            <h4 style="font-size: 1.125rem; font-weight: 600; color: #1F2937; margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #E5E7EB;">
                <i class="fas fa-envelope" style="color: #EF4444; margin-right: 0.5rem;"></i>
                Información de Contacto
            </h4>
            
            <div class="grid grid-cols-2">
                <div class="form-group">
                    <label class="form-label" for="contact_email">Email de Contacto *</label>
                    <input type="email" id="contact_email" name="contact_email" class="form-input" placeholder="hr@empresa.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="contact_phone">Teléfono (Opcional)</label>
                    <input type="tel" id="contact_phone" name="contact_phone" class="form-input" placeholder="+52 55 1234 5678">
                </div>
            </div>
        </div>
        
        <!-- Form Actions -->
        <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #E5E7EB; display: flex; gap: 1rem; justify-content: flex-end;">
            <button type="button" class="btn btn-secondary" onclick="saveDraft()">
                <i class="fas fa-save"></i>
                Guardar Borrador
            </button>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-paper-plane"></i>
                Publicar Vacante
            </button>
        </div>
    </form>
</div>

<!-- Preview Card -->
<div class="card" style="margin-top: 2rem;">
    <div class="card-header">
        <h3 class="card-title">Vista Previa</h3>
        <button class="btn btn-secondary btn-sm" onclick="togglePreview()">
            <i class="fas fa-eye"></i>
            Mostrar/Ocultar
        </button>
    </div>
    
    <div class="card-body" id="preview-content" style="display: none;">
        <div style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 1.5rem; background: #F9FAFB;">
            <h3 id="preview-title" style="color: #1F2937; margin-bottom: 0.5rem;">Título del Puesto</h3>
            <p id="preview-company-location" style="color: #6B7280; margin-bottom: 1rem;">Empresa • Ubicación</p>
            
            <div id="preview-badges" style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
                <!-- Badges se generarán dinámicamente -->
            </div>
            
            <p id="preview-description" style="color: #374151; line-height: 1.6;">
                Descripción del puesto aparecerá aquí...
            </p>
            
            <div id="preview-skills" style="margin-top: 1rem;">
                <h4 style="font-size: 1rem; color: #1F2937; margin-bottom: 0.5rem;">Habilidades Requeridas:</h4>
                <div id="preview-required-skills" style="display: flex; gap: 0.5rem; flex-wrap: wrap;"></div>
                
                <h4 style="font-size: 1rem; color: #1F2937; margin-top: 1rem; margin-bottom: 0.5rem;">Habilidades Deseadas:</h4>
                <div id="preview-desired-skills" style="display: flex; gap: 0.5rem; flex-wrap: wrap;"></div>
            </div>
            
            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #E5E7EB;">
                <small id="preview-salary" style="color: #6B7280;"></small>
                <small id="preview-deadline" style="color: #6B7280; display: block; margin-top: 0.5rem;"></small>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Función para mostrar/ocultar la vista previa
function togglePreview() {
    const preview = document.getElementById('preview-content');
    preview.style.display = preview.style.display === 'none' ? 'block' : 'none';
    if(preview.style.display === 'block') {
        updatePreview(); // Actualizar al mostrar
    }
}

// Función para actualizar la vista previa
function updatePreview() {
    // Obtener valores del formulario
    const jobTitle = document.getElementById('job_title').value || 'Título del Puesto';
    const company = document.getElementById('company').value || 'Empresa';
    const location = document.getElementById('location').value || 'Ubicación';
    const jobType = document.getElementById('job_type').value;
    const workMode = document.getElementById('work_mode').value;
    const experience = document.getElementById('experience_level').value;
    const salaryMin = document.getElementById('salary_min').value;
    const salaryMax = document.getElementById('salary_max').value;
    const deadline = document.getElementById('deadline').value;
    const description = document.getElementById('job_description').value || 'Descripción del puesto aparecerá aquí...';
    const requirements = document.getElementById('requirements').value;
    const skills = document.getElementById('skills').value;
    const niceToHave = document.getElementById('nice_to_have').value;
    
    // Actualizar elementos de la vista previa
    document.getElementById('preview-title').textContent = jobTitle;
    document.getElementById('preview-company-location').textContent = `${company} • ${location}`;
    document.getElementById('preview-description').textContent = description;
    
    // Actualizar badges
    const badgesContainer = document.getElementById('preview-badges');
    badgesContainer.innerHTML = '';
    
    // Mapeo de valores a textos para los badges
    const jobTypeMap = {
        'full-time': 'Tiempo Completo',
        'part-time': 'Medio Tiempo',
        'contract': 'Por Contrato',
        'internship': 'Prácticas'
    };
    
    const workModeMap = {
        'presencial': 'Presencial',
        'remote': 'Remoto',
        'hybrid': 'Híbrido'
    };
    
    const experienceMap = {
        'entry': 'Sin experiencia',
        'junior': 'Junior',
        'mid': 'Mid-level',
        'senior': 'Senior',
        'lead': 'Lead/Manager'
    };
    
    // Añadir badges según los valores seleccionados
    if(jobType) {
        const badge = createBadge(jobTypeMap[jobType], 'badge-info');
        badgesContainer.appendChild(badge);
    }
    
    if(workMode) {
        const badge = createBadge(workModeMap[workMode], 'badge-info');
        badgesContainer.appendChild(badge);
    }
    
    if(experience) {
        const badge = createBadge(experienceMap[experience], 'badge-info');
        badgesContainer.appendChild(badge);
    }
    
    // Actualizar información de salario
    const salaryText = [];
    if(salaryMin) salaryText.push(`Desde: $${salaryMin} MXN`);
    if(salaryMax) salaryText.push(`Hasta: $${salaryMax} MXN`);
    document.getElementById('preview-salary').textContent = salaryText.join(' | ');
    
    // Actualizar fecha límite
    if(deadline) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        const formattedDate = new Date(deadline).toLocaleDateString('es-MX', options);
        document.getElementById('preview-deadline').textContent = `Fecha límite: ${formattedDate}`;
    } else {
        document.getElementById('preview-deadline').textContent = '';
    }
    
    // Actualizar habilidades
    updateSkillsPreview('preview-required-skills', skills);
    updateSkillsPreview('preview-desired-skills', niceToHave);
}

// Función auxiliar para crear badges
function createBadge(text, className) {
    const badge = document.createElement('span');
    badge.className = `badge ${className}`;
    badge.textContent = text;
    return badge;
}

// Función para actualizar las habilidades en la vista previa
function updateSkillsPreview(containerId, skillsText) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    
    if(!skillsText) return;
    
    const skills = skillsText.split(',').map(skill => skill.trim()).filter(skill => skill);
    
    skills.forEach(skill => {
        const skillBadge = createBadge(skill, 'badge-secondary');
        container.appendChild(skillBadge);
    });
}

// Escuchar cambios en los inputs del formulario
document.querySelectorAll('#job_title, #company, #location, #job_type, #work_mode, #experience_level, #salary_min, #salary_max, #deadline, #job_description, #requirements, #skills, #nice_to_have').forEach(input => {
    input.addEventListener('input', updatePreview);
    input.addEventListener('change', updatePreview);
});

// Actualizar al cargar la página si hay valores
document.addEventListener('DOMContentLoaded', function() {
    // Si el preview está visible, actualizarlo
    if(document.getElementById('preview-content').style.display !== 'none') {
        updatePreview();
    }
});
</script>
{% endblock %}