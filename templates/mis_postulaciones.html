<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Postulaciones - Workify</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='Postulaciones.css') }}">
</head>
<body>
    <!-- Incluir el navbar -->
    {% include 'components/navbar_usuarios.html' %}

    <div class="container">
        <div class="header">
            <h1>Mis Postulaciones</h1>
            <p>Revisa el estado de todas tus postulaciones a vacantes</p>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label for="status-filter">Filtrar por estado:</label>
                <select id="status-filter">
                    <option value="todos">Todas las postulaciones</option>
                    <option value="pendiente">Pendiente de revisi贸n</option>
                    <option value="revisando">En revisi贸n</option>
                    <option value="aceptada">Aceptada</option>
                    <option value="rechazada">Rechazada</option>
                </select>
            </div>
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Buscar por empresa o puesto...">
                <button type="button" id="search-btn">
                    <i class="search-icon"></i>
                </button>
            </div>
        </div>

        <div class="postulaciones-container">
            {% if postulaciones %}
                {% for postulacion in postulaciones %}
                <div class="postulacion-card" data-status="{{ postulacion.estado }}">
                    <div class="postulacion-header">
                        <div class="empresa-info">
                            <img src="{{ url_for('static', filename='images/avatar.png') }}" alt="Logo empresa" class="empresa-logo">
                            <div class="empresa-details">
                                <h3>{{ postulacion.titulo }}</h3>
                                <p class="empresa-nombre">{{ postulacion.empresa }}</p>
                                <p class="ubicacion"> {{ postulacion.ubicacion }}</p>
                            </div>
                        </div>
                        <div class="status-badge status-{{ postulacion.estado }}">
                            {% if postulacion.estado == 'pendiente' %}
                                Pendiente
                            {% elif postulacion.estado == 'revisando' %}
                                En Revisi贸n
                            {% elif postulacion.estado == 'aceptada' %}
                                Aceptada
                            {% elif postulacion.estado == 'rechazada' %}
                                Rechazada
                            {% elif postulacion.estado == 'cancelada' %}
                                Cancelada
                            {% else %}
                                {{ postulacion.estado|title }}
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="postulacion-details">
                        <div class="detail-row">
                            <span class="label">Salario:</span>
                            <span class="value">
                                {% if postulacion.salario_min and postulacion.salario_max %}
                                    ${{ postulacion.salario_min }} - ${{ postulacion.salario_max }} MXN
                                {% else %}
                                    No especificado
                                {% endif %}
                            </span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Modalidad:</span>
                            <span class="value">{{ postulacion.modalidad }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Tipo de contrato:</span>
                            <span class="value">{{ postulacion.tipo_contrato }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Fecha de postulaci贸n:</span>
                            <span class="value">
                                {% if postulacion.fecha_postulacion %}
                                    {{ postulacion.fecha_postulacion.strftime('%d de %B, %Y') if postulacion.fecha_postulacion else 'No especificada' }}
                                {% else %}
                                    No especificada
                                {% endif %}
                            </span>
                        </div>
                        <div class="detail-row">
                            <span class="label">ltima actualizaci贸n:</span>
                            <span class="value">
                                {% if postulacion.fecha_actualizacion %}
                                    {{ postulacion.fecha_actualizacion.strftime('%d de %B, %Y') }}
                                {% else %}
                                    No actualizada
                                {% endif %}
                            </span>
                        </div>
                    </div>

                    <div class="postulacion-actions">
                        <button class="btn-ver-detalles">Ver Detalles</button>
                        {% if postulacion.estado == 'pendiente' or postulacion.estado == 'revisando' %}
                        <button class="btn-cancelar" onclick="cancelarPostulacion({{ postulacion.id }})">Cancelar Postulaci贸n</button>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-postulaciones">
                    <div class="empty-state">
                        <img src="{{ url_for('static', filename='images/avatar.png') }}" alt="Sin postulaciones" class="empty-icon">
                        <h3>No tienes postulaciones a煤n</h3>
                        <p>Explora las vacantes disponibles y comienza a postularte</p>
                        <a href="/inicio/usuarios" class="btn-explorar">Explorar Vacantes</a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    
    <!-- Script para funcionalidades de postulaciones -->
    <script>
        function cancelarPostulacion(postulacionId) {
            if (confirm('驴Est谩s seguro de que quieres cancelar esta postulaci贸n?')) {
                const formData = new FormData();
                formData.append('postulacion_id', postulacionId);
                
                fetch('/cancelar_postulacion', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Postulaci贸n cancelada exitosamente');
                        // Recargar la p谩gina para mostrar el estado actualizado
                        window.location.reload();
                    } else {
                        alert('Error: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al cancelar la postulaci贸n');
                });
            }
        }

        // Filtro por estado
        document.getElementById('status-filter').addEventListener('change', function() {
            const status = this.value;
            const cards = document.querySelectorAll('.postulacion-card');
            
            cards.forEach(card => {
                if (status === 'todos' || card.dataset.status === status) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // B煤squeda
        document.getElementById('search-btn').addEventListener('click', function() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const cards = document.querySelectorAll('.postulacion-card');
            
            cards.forEach(card => {
                const title = card.querySelector('h3').textContent.toLowerCase();
                const empresa = card.querySelector('.empresa-nombre').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || empresa.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // B煤squeda en tiempo real
        document.getElementById('search-input').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const cards = document.querySelectorAll('.postulacion-card');
            
            cards.forEach(card => {
                const title = card.querySelector('h3').textContent.toLowerCase();
                const empresa = card.querySelector('.empresa-nombre').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || empresa.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html> 