<!DOCTYPE html>
<html lang="es">
<head>
    <!-- separar logica css con logica html -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Empleo - Buscar Trabajo</title>
    <link rel="stylesheet" href="{{url_for('static',filename='Inicio_usuarios.css')}}">
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    {% include 'components/navbar_usuarios.html' %}

    <!-- Contenido principal -->
    <div class="main-content">
        <!-- Sección hero -->
        <section class="hero-section">
            <h1>Encuentra tu trabajo ideal</h1>
            <p>Explora miles de oportunidades laborales y encuentra la posición perfecta para tu carrera profesional.</p>
        </section>

        <!-- Sección de vacantes -->
        <section class="jobs-section">
            <div class="section-header">
                <h2>Vacantes disponibles</h2>
                <p>Descubre las mejores oportunidades laborales en tu área</p>
            </div>

            <div class="jobs-grid">
                {% if vacantes %}
                    {% for vacante in vacantes %}
                    <div class="job-card" data-vacante-id="{{ vacante.id }}">
                        <div class="job-header">
                            <h3 class="job-title">{{ vacante.titulo }}</h3>
                            <span class="job-type">{{ vacante.tipo_contrato }}</span>
                        </div>
                        <div class="job-company">
                            <i class="fas fa-building"></i>
                            <span>{{ vacante.empresa }}</span>
                        </div>
                        <div class="job-location">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>{{ vacante.ubicacion }}</span>
                        </div>
                        <p class="job-description">
                            {{ vacante.descripcion[:150] }}{% if vacante.descripcion|length > 150 %}...{% endif %}
                        </p>
                        <div class="job-tags">
                            <span class="tag">{{ vacante.modalidad }}</span>
                            <span class="tag">{{ vacante.tipo_contrato }}</span>
                            {% if vacante.salario_min and vacante.salario_max %}
                            <span class="tag">${{ vacante.salario_min }}-${{ vacante.salario_max }}</span>
                            {% endif %}
                        </div>
                        
                        <button class="btn-apply" onclick="aplicarVacante({{ vacante.id }})">Aplicar ahora</button>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="no-vacantes">
                        <p>No hay vacantes disponibles en este momento.</p>
                    </div>
                {% endif %}
            </div>
        </section>
    </div>
    
    <!-- Script para la navbar -->
    <script src="{{ url_for('static', filename='navbar.js') }}"></script>
    
    <!-- Script para aplicar a vacantes -->
    <script>
        function aplicarVacante(vacanteId) {
            // Verificar si el usuario está logueado
            {% if session.user_id %}
                // Crear formulario para enviar la postulación
                const formData = new FormData();
                formData.append('vacante_id', vacanteId);
                
                // Enviar la postulación
                fetch('/aplicar_vacante', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Eliminar la tarjeta del DOM
                        const card = document.querySelector(`[data-vacante-id="${vacanteId}"]`);
                        if (card) {
                            card.remove();
                        }
                        
                        // Si ya no hay tarjetas, mostrar estado vacío
                        const remaining = document.querySelectorAll('.job-card');
                        if (remaining.length === 0) {
                            const grid = document.querySelector('.jobs-grid');
                            if (grid) {
                                grid.innerHTML = `
                                    <div class="no-vacantes">
                                        <p>No hay vacantes disponibles en este momento.</p>
                                    </div>
                                `;
                            }
                        }
                        
                        alert('¡Postulación enviada exitosamente!');
                    } else {
                        alert('Error: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al enviar la postulación');
                });
            {% else %}
                // Redirigir al login si no está logueado
                window.location.href = '/login';
            {% endif %}
        }
    </script>
</body>
</html>
