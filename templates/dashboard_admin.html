<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrador - Workify</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
</head>
<body>
    <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Abrir menú">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="28" height="28">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5M3.75 17.25h16.5" />
        </svg>
    </button>
    <div class="dashboard">
        {% include 'components/sidebar_admin.html' %}
        <main class="main">
            <div class="main-title">Panel de Administración</div>
            <div class="tab-content active" id="usuarios">
                <!-- Formulario para agregar Admin/Empresa -->
                <h3>Agregar Usuario (Administrador/Reclutador)</h3>
                <form method="POST" action="{{ url_for('agregar_usuario') }}" style="margin-bottom:2rem;">
                    <input type="text" name="username" placeholder="Nombre de usuario" required maxlength="50">
                    <input type="email" name="correo" placeholder="Correo" required maxlength="50">
                    <input type="password" name="contra" placeholder="Contraseña" required maxlength="30">
                    <select name="tipo_usuario" required>
                        <option value="admin">Administrador</option>
                        <option value="reclutador">Reclutador</option>
                    </select>
                    <button type="submit">Agregar</button>
                </form>

                <!-- Tabla de usuarios admin y empresa -->
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usuario</th>
                            <th>Correo</th>
                            <th>Tipo</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for u in usuarios %}
                        <tr>
                            <td>{{ u[0] }}</td> <!-- ID -->
                            <td>{{ u[3] }}</td> <!-- Username -->
                            <td>{{ u[1] }}</td> <!-- Correo -->
                            <td>{{ u[2] }}</td> <!-- Tipo -->
                            <td style="display: flex; gap: 0.5rem;">
                                <button type="button"
                                    onclick="openEditModal('{{ u[0] }}', '{{ u[1] }}', '{{ u[2] }}', '{{ u[3] }}')"
                                    style="background:#3b82f6;color:#fff;border:none;padding:0.5rem 1rem;border-radius:0.5rem;">
                                    Modificar
                                </button>
                                <form method="POST" action="{{ url_for('eliminar_usuario', id=u[0]) }}" onsubmit="return confirm('¿Seguro que deseas eliminar este usuario?');">
                                    <button type="submit" style="background:#ef4444;color:#fff;border:none;padding:0.5rem 1rem;border-radius:0.5rem;">Eliminar</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
    <!-- Modal para editar usuario -->
            <div id="editUserModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeEditModal()">&times;</span>
                <h2>Editar Usuario</h2>
                <form id="editUserForm" method="POST">
                    <input type="hidden" name="id" id="edit-id">
                    <label for="edit-username">Nombre de usuario:</label>
                    <input type="text" name="username" id="edit-username" required>
                    <label for="edit-correo">Correo:</label>
                    <input type="email" name="correo" id="edit-correo" required>
                    <label for="edit-contra">Contraseña:</label>
                    <input type="password" name="contra" id="edit-contra" placeholder="Nueva contraseña (opcional)">
                    <label for="edit-tipo">Tipo de usuario:</label>
                    <select name="tipo_usuario" id="edit-tipo" required>
                        <option value="admin">Administrador</option>
                        <option value="reclutador">Reclutador</option>
                    </select>
                    <button type="submit">Guardar Cambios</button>
                </form>
            </div>
        </div>


    <script>
        // Tabs
        document.querySelectorAll('.sidebar-link').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.sidebar-link').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(this.dataset.tab).classList.add('active');
            });
        });
        // Sidebar toggle (responsive)
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }
        // Sidebar collapse/expand
        function collapseSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
        }
        // Edit User Modal
        function openEditModal(id, correo, tipo, username) {
            document.getElementById('edit-id').value = id;
            document.getElementById('edit-username').value = username;
            document.getElementById('edit-correo').value = correo;
            document.getElementById('edit-tipo').value = tipo;
            document.getElementById('edit-contra').value = '';
            document.getElementById('editUserModal').style.display = 'block';
            document.getElementById('editUserForm').action = '/admin/editar_usuario/' + id;
        }
        function closeEditModal() {
            document.getElementById('editUserModal').style.display = 'none';
        }
        window.onclick = function(event) {
            var modal = document.getElementById('editUserModal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>
</body>
</html>